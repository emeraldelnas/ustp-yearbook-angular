<nb-layout>
  <nb-layout-column>

    <nb-card class="form-card" *ngIf="!success" [nbSpinner]="id_number.pending" nbSpinnerStatus="success">
      <nb-card-body>
        <form [formGroup]="graduateForm" (ngSubmit)="checkDetails(dialog)" class="step-container">
          <p class="form-group-title">Personal Info</p>
          <div class="form-groups">
            <div class="form-control">
              <label class="label" for="id_number">ID No:</label>
              <input nbInput fullWidth
                formControlName="id_number"
                name="id_number"
                type="tel"
                id="id_number"
                placeholder="2014100434"
                [status]="id_number.dirty ? (id_number.invalid  ? 'danger' : 'success') : 'basic'">
              <p *ngIf="id_number.pending">
                Checking ID No...
              </p>
              <ng-container *ngIf="id_number.invalid && id_number.touched">
                <p class="error-message" *ngIf="id_number.errors?.pattern">
                  ID number should have 10-digits
                </p>
              </ng-container>
            </div>
          </div>

          <nb-alert status="danger" *ngIf="id_number.invalid && id_number.errors?.idNoTaken">
            The ID number provided has already been used.
          </nb-alert>

          <div *ngIf="id_number.valid">
            <div class="form-groups">
              <div class="form-control">
                <label class="label" for="first_name">First name:</label>
                <input nbInput fullWidth
                  formControlName="first_name"
                  name="first_name"
                  type="text"
                  id="first_name"
                  placeholder="Thomas"
                  [status]="first_name.dirty ? (first_name.invalid  ? 'danger' : 'success') : 'basic'">
                <ng-container *ngIf="first_name.invalid && first_name.touched">
                  <p class="error-message" *ngIf="first_name.errors?.required">
                    First name is required!
                  </p>
                </ng-container>
              </div>
              <div class="form-control">
                <label class="label" for="mid_name">Middle name:</label>
                <input nbInput fullWidth
                  formControlName="mid_name"
                  name="mid_name"
                  type="text"
                  id="mid_name"
                  placeholder="And"
                  [status]="mid_name.dirty ? (mid_name.invalid  ? 'danger' : 'success') : 'basic'">
                <ng-container *ngIf="mid_name.invalid && mid_name.touched">
                  <p class="error-message" *ngIf="mid_name.errors?.required">
                    Middle name is required!
                  </p>
                </ng-container>
              </div>
              <div class="form-control">
                <label class="label" for="last_name">Last name:</label>
                <input nbInput fullWidth
                  formControlName="last_name"
                  name="last_name"
                  type="text"
                  id="last_name"
                  placeholder="Prends"
                  [status]="last_name.dirty ? (last_name.invalid  ? 'danger' : 'success') : 'basic'">
                <ng-container *ngIf="last_name.invalid && last_name.touched">
                  <p class="error-message" *ngIf="last_name.errors?.required">
                    Last name is required!
                  </p>
                </ng-container>
              </div>
              <div class="form-control">
                <label class="label" for="email">Email:</label>
                <input nbInput fullWidth
                  formControlName="email"
                  name="email"
                  type="email"
                  id="email"
                  placeholder="thomas@example.com"
                  [status]="email.dirty ? (email.invalid  ? 'danger' : 'success') : 'basic'">
                <ng-container *ngIf="email.invalid && email.touched">
                  <p class="error-message" *ngIf="email.errors?.required">
                    Email is required!
                  </p>
                  <p class="error-message" *ngIf="email.errors?.pattern">
                    Email should be a valid one!
                  </p>
                </ng-container>
              </div>
              <div class="form-control">
                <label class="label" for="mobile">Mobile:</label>
                <input nbInput fullWidth
                  formControlName="mobile"
                  name="mobile"
                  type="number"
                  id="mobile"
                  placeholder="09769325418"
                  [status]="mobile.dirty ? (mobile.invalid  ? 'danger' : 'success') : 'basic'">
                <ng-container *ngIf="mobile.invalid && mobile.touched">
                  <p class="error-message" *ngIf="mobile.errors?.required">
                    Mobile number is required!
                  </p>
                  <p class="error-message" *ngIf="mobile.hasError('pattern')">
                    Mobile number should be 11-digits!
                  </p>
                </ng-container>
              </div>
              <div class="form-control">
                <label class="label" for="birthday">Birthday</label>
                <input nbInput fullWidth id="birthday" [nbDatepicker]="birthday" formControlName="birthday">
                <nb-datepicker #birthday></nb-datepicker>
              </div>
            </div>





            <p class="form-group-title">Graduate Info</p>
            <div class="form-groups">
              <div class="form-control">
                <label class="label" for="course">Course:</label>
                <input nbInput fullWidth
                  formControlName="course"
                  name="course"
                  type="text"
                  id="course"
                  placeholder="BS Information Technology"
                  [status]="course.dirty ? (course.invalid  ? 'danger' : 'success') : 'basic'">
                <ng-container *ngIf="course.invalid && course.touched">
                  <p class="error-message" *ngIf="course.errors?.required">
                    Course is required!
                  </p>
                </ng-container>
              </div>
              <div class="form-control">
                <label class="label" for="college">College:</label>
                <input nbInput fullWidth
                  formControlName="college"
                  name="college"
                  type="text"
                  id="college"
                  placeholder="College of Information Technology"
                  [status]="college.dirty ? (college.invalid  ? 'danger' : 'success') : 'basic'">
                <ng-container *ngIf="college.invalid && college.touched">
                  <p class="error-message" *ngIf="college.errors?.required">
                    College is required!
                  </p>
                </ng-container>
              </div>
              <div class="form-control">
                <label class="label" for="affiliations">Affiliations:</label>
                <textarea nbInput fullWidth
                  formControlName="affiliations"
                  name="affiliations"
                  id="affiliations"
                  placeholder="Max of 3 Affiliations."
                  rows="5"
                  [status]="affiliations.dirty ? (affiliations.invalid  ? 'danger' : 'success') : 'basic'"></textarea>
                <ng-container *ngIf="affiliations.invalid && affiliations.touched">
                  <p class="error-message" *ngIf="affiliations.errors?.required">
                    Affiliations is required!
                  </p>
                </ng-container>
              </div>
              <div class="form-control">
                <label class="label" for="awards">Awards:</label>
                <textarea nbInput fullWidth
                  formControlName="awards"
                  name="awards"
                  id="awards"
                  placeholder="Max of 3 Awards."
                  rows="5"
                  [status]="awards.dirty ? (awards.invalid  ? 'danger' : 'success') : 'basic'"></textarea>
                <ng-container *ngIf="awards.invalid && awards.touched">
                  <p class="error-message" *ngIf="awards.errors?.required">
                    Awards is required!
                  </p>
                </ng-container>
              </div>
              <div class="form-control">
                <label class="label" for="motto">Motto:</label>
                <textarea nbInput fullWidth
                  formControlName="motto"
                  name="motto"
                  id="motto"
                  placeholder="Life is good!"
                  rows="5"
                  [status]="motto.dirty ? (motto.invalid  ? 'danger' : 'success') : 'basic'"></textarea>
                <ng-container *ngIf="motto.invalid && motto.touched">
                  <p class="error-message" *ngIf="motto.errors?.required">
                    Motto is required!
                  </p>
                </ng-container>
              </div>
            </div>




            <p class="form-group-title">Schedule Photoshoot</p>
            <div class="form-groups">
              <div class="form-control">
                <label class="label" for="shoot_date">Shoot Date</label>
                <input nbInput fullWidth id="shoot_date" [nbDatepicker]="shoot_date" formControlName="shoot_date">
                <nb-datepicker #shoot_date [min]="minDate" [max]="maxDate" (dateChange)="onDateChange($event)"></nb-datepicker>
              </div>




              <div class="form-control">
                <label class="label" for="time_period">AM or PM:</label>
                <nb-radio-group formControlName="time_period" name="time_period" [status]="time_period.dirty ? (time_period.invalid  ? 'danger' : 'success') : 'basic'">
                  <nb-radio
                    *ngFor="let period of timePeriods"
                    [value]="period.period">
                    {{ period.period | uppercase}}
                  </nb-radio>
                </nb-radio-group>
                <ng-container *ngIf="time_period.invalid && submitted">
                  <p class="error-message" *ngIf="time_period.errors?.required">
                    Time period is required!
                  </p>
                </ng-container>
              </div>




              <div class="form-control">
                <label class="label" for="shoot_time">Shoot Time</label>
                <nb-radio-group formControlName="shoot_time" class="timeslots" name="shoot_time" [status]="shoot_time.dirty ? (shoot_time.invalid  ? 'danger' : 'success') : 'basic'">
                  <nb-radio
                    *ngFor="let timeSlot of filterTimeSlotsOfType(time_period.value)"
                    [value]="timeSlot.value">
                    {{ timeSlot.time }} {{ timeSlot.period }}
                  </nb-radio>
                </nb-radio-group>
                <ng-container *ngIf="shoot_time.invalid && submitted">
                  <p class="error-message" *ngIf="shoot_time.errors?.required">
                    Shoot time is required!
                  </p>
                </ng-container>
              </div>
            </div>



            <p class="form-group-title">Payment Info</p>
            <div class="form-groups">
              <div class="form-control">
                <label class="label" for="course">Package:</label>
                <nb-radio-group formControlName="package" class="package-radio-group" name="package" [status]="package.dirty ? (package.invalid  ? 'danger' : 'success') : 'basic'">
                  <nb-radio value="All in One">All in One</nb-radio>
                  <nb-radio value="Photoshoot Only">Photoshoot Only</nb-radio>
                </nb-radio-group>
                <ng-container *ngIf="package.invalid && submitted">
                  <p class="error-message" *ngIf="package.errors?.required">
                    Package is required!
                  </p>
                </ng-container>
                <div class="package-info" *ngIf="package.value === 'All in One'">
                  <div class="header">
                    <p>"All in One" details:</p>
                    <p>P2,090</p>
                  </div>
                  <div class="body">
                    <p>1x Yearbook (Hard Copy)</p>
                    <p>Photoshoot (Toga & Casual)</p>
                    <p>Photos hard copies:</p>
                    <div class="small">
                      <p>1x 8R size</p>
                      <p>1x 3R size</p>
                      <p>1x 2R size</p>
                    </div>
                    <p>Single use laundered & disinfected toga</p>
                  </div>
                  <div class="footer">
                    <p><span class="price">P1,600</span> - Yearbook (Hard Copy)</p>
                    <p><span class="price">P450</span> - Photoshoot w/ Hard Copies</p>
                    <p><span class="price">P40</span> - Operating Expense</p>
                    <p class="total"><span class="price">P2,090</span> - Total</p>
                  </div>
                </div>
                <div class="package-info" *ngIf="package.value === 'Photoshoot Only'">
                  <div class="header">
                    <p>"Photoshoot Only" details:</p>
                    <p>P490</p>
                  </div>
                  <div class="body">
                    <p class="strike">1x Yearbook (Hard Copy)</p>
                    <p>Photoshoot (Toga & Casual)</p>
                    <p>Photos hard copies:</p>
                    <div class="small">
                      <p>1x 8R size</p>
                      <p>1x 3R size</p>
                      <p>1x 2R size</p>
                    </div>
                    <p>Single use laundered & disinfected toga</p>
                  </div>
                  <div class="footer">
                    <p><span class="price">P450</span> - Photoshoot w/ Hard Copies</p>
                    <p><span class="price">P40</span> - Operating Expense</p>
                    <p class="total"><span class="price">P490</span> - Total</p>
                  </div>
                </div>
              </div>



              <div class="form-control">
                <label class="label" for="receipt_details">Payment receipt details:</label>
                <textarea nbInput fullWidth
                  formControlName="receipt_details"
                  name="receipt_details"
                  id="receipt_details"
                  placeholder=""
                  rows="7"
                  [status]="receipt_details.dirty ? (receipt_details.invalid  ? 'danger' : 'success') : 'basic'"></textarea>
                <ng-container *ngIf="receipt_details.invalid && receipt_details.touched">
                  <p class="error-message" *ngIf="receipt_details.errors?.required">
                    Receipt details is required!
                  </p>
                </ng-container>
              </div>
            </div>












            <div class="submit-container">
              <button nbButton status="primary" [disabled]="graduateForm.invalid">Confirm</button>
            </div>
          </div>
        </form>
      </nb-card-body>
    </nb-card>

    <nb-alert class="success-alert" status="success" *ngIf="success">
      Your photoshoot booking was successful!
    </nb-alert>

  </nb-layout-column>
</nb-layout>

<ng-template #dialog let-data let-ref="dialogRef">
  <nb-card accent="primary" class="confirm-dialog">
    <nb-card-header>Confirm details:</nb-card-header>
    <nb-card-body>
      <div class="detail">
        <p>ID No.</p>
        <p>{{id_number.value}}</p>
      </div>
      <div class="detail">
        <p>Name</p>
        <p>{{first_name.value}} {{mid_name.value}} {{last_name.value}}</p>
      </div>
      <div class="detail">
        <p>Email</p>
        <p>{{email.value}}</p>
      </div>
      <div class="detail">
        <p>Mobile</p>
        <p>{{mobile.value}}</p>
      </div>
      <div class="detail">
        <p>Birthday</p>
        <p>{{birthday.value | date:'mediumDate'}}</p>
      </div>
      <div class="detail">
        <p>Course</p>
        <p>{{course.value}}</p>
      </div>
      <div class="detail">
        <p>College</p>
        <p>{{college.value}}</p>
      </div>
      <div class="detail">
        <p>Affiliations</p>
        <p>{{affiliations.value}}</p>
      </div>
      <div class="detail">
        <p>Awards</p>
        <p>{{awards.value}}</p>
      </div>
      <div class="detail">
        <p>Motto</p>
        <p>{{motto.value}}</p>
      </div>
      <div class="detail">
        <p>Shoot schedule</p>
        <p>{{shoot_date.value | date:'mediumDate'}} {{shoot_time.value}} {{time_period.value}}</p>
      </div>
      <div class="detail">
        <p>Package</p>
        <p>{{package.value}}</p>
      </div>
      <div class="detail">
        <p>Payment receipt</p>
        <p>{{receipt_details.value}}</p>
      </div>
    </nb-card-body>
    <nb-card-footer>
      <button nbButton status="success" (click)="submit(ref)">Submit</button>
      <button nbButton status="basic" (click)="ref.close()">Cancel</button>
    </nb-card-footer>
  </nb-card>
</ng-template>
